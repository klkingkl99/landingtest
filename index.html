<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mini Game</title>

  <!-- ‚úÖ Meta Pixel (Êç¢Êàê‰Ω†ÁöÑ Pixel ID) -->
  <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');

    fbq('init', '834846389592269');   // ‚úÖ ÊîπËøôÈáå
    fbq('track', 'PageView');
  </script>
  <noscript>
    <img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=834846389592269&ev=PageView&noscript=1"/>
  </noscript>

  <style>
    :root{
      --text:#eef6ff;
      --muted:rgba(238,246,255,.72);
      --panel:rgba(14,18,32,.72);
      --panel2:rgba(14,18,32,.86);
      --line:rgba(255,255,255,.12);
      --gold:#ffd36a;
      --gold2:#ffb84d;
      --shadow:rgba(0,0,0,.45);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:#050a14;
      overflow-x:hidden;
    }

    /* ‚úÖ ËÉåÊôØÂ±ÇÔºöÊîæ GIF */
    .bgWrap{
      position:fixed; inset:0;
      overflow:hidden;
      z-index:0;
    }
    .bg{
      position:absolute; inset:-30px;
      background:url("./abgc44.gif") center/cover no-repeat;
      transform:translate3d(0,0,0) scale(1.06);
      filter:saturate(1.08) brightness(1.02);
      will-change:transform;
    }
    .shade{
      position:absolute; inset:0;
      background:
        radial-gradient(900px 520px at 50% 15%, rgba(255,255,255,.10), rgba(255,255,255,0) 60%),
        linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.60));
      pointer-events:none;
    }
    .vignette{
      position:absolute; inset:0;
      background:radial-gradient(900px 650px at 50% 40%, rgba(0,0,0,0), rgba(0,0,0,.68) 80%);
      pointer-events:none;
    }

    .wrap{
      position:relative; z-index:1;
      max-width:520px;
      margin:0 auto;
      padding:16px 14px 30px;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 12px;
      border-radius:var(--r);
      background:rgba(10,14,26,.65);
      border:1px solid rgba(255,255,255,.10);
      backdrop-filter:blur(12px);
      box-shadow:0 10px 25px var(--shadow);
    }
    .brand{display:flex; gap:10px; align-items:center; font-weight:900}
    .logo{
      width:34px;height:34px;border-radius:12px;
      background:radial-gradient(circle at 30% 30%, rgba(255,211,106,.95), rgba(255,211,106,.10));
      border:1px solid rgba(255,211,106,.35);
      box-shadow:0 10px 20px rgba(0,0,0,.25);
    }
    .menu{opacity:.9;font-size:14px;color:var(--muted)}

    .card{
      border-radius:var(--r);
      background:var(--panel);
      border:1px solid rgba(255,255,255,.10);
      backdrop-filter:blur(12px);
      box-shadow:0 10px 25px var(--shadow);
      overflow:hidden;
    }

    .chat{padding:14px 14px 10px}
    .bubble{
      display:inline-block;
      max-width:92%;
      padding:10px 12px;
      border-radius:16px;
      background:rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.10);
      margin-bottom:10px;
      line-height:1.35;
      font-size:14.5px;
    }
    .bubble.me{
      background:rgba(255,211,106,.12);
      border:1px solid rgba(255,211,106,.22);
    }

    .game{padding:14px; display:flex; flex-direction:column; gap:12px;}
    .headline{font-size:26px; font-weight:950; margin:6px 0 0}
    .sub{margin:6px 0 0; color:var(--muted); font-size:14px; line-height:1.4}

    .progress{
      margin-top:10px;
      display:flex;
      align-items:center;
      gap:12px;
      color:var(--muted);
      font-size:13px;
    }
    .bar{flex:1; height:8px; border-radius:999px; background:rgba(255,255,255,.12); overflow:hidden}
    .bar > i{
      display:block;
      height:100%;
      width:0%;
      background:linear-gradient(90deg, var(--gold), rgba(255,211,106,.20));
      border-radius:999px;
      transition:width .28s ease;
    }

    .choices{
      display:grid;
      grid-template-columns:repeat(3, 1fr);
      gap:10px;
      margin-top:10px;
    }
    .choice{
      padding:12px 10px;
      border-radius:16px;
      background:rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.12);
      text-align:center;
      cursor:pointer;
      user-select:none;
      transition:transform .12s ease, border-color .12s ease, background .12s ease, box-shadow .12s ease, opacity .12s ease;
      position:relative;
    }
    .choice:hover{ transform:translateY(-2px); border-color:rgba(255,211,106,.28); box-shadow:0 12px 26px rgba(0,0,0,.28); }
    .choice.selected{
      border-color:rgba(255,211,106,.65);
      background:rgba(255,211,106,.10);
      box-shadow:0 16px 34px rgba(0,0,0,.32);
    }
    .choice.used{
      opacity:.35;
      filter:saturate(.7);
      pointer-events:none;
    }
    .chest-icon{
      width:54px;height:54px;
      margin:0 auto 8px;
      display:block;
      object-fit:contain;
      filter:drop-shadow(0 12px 18px rgba(0,0,0,.38));
      transition:transform .16s ease;
    }
    .choice.selected .chest-icon{ transform:scale(1.06) rotate(-2deg); }
    .choice strong{display:block; font-size:13px; font-weight:900}
    .choice span{display:block; margin-top:6px; font-size:12px; color:var(--muted)}

    .cta{margin-top:10px; display:flex; gap:10px}
    .btn{
      width:100%;
      padding:14px 14px;
      border-radius:999px;
      cursor:pointer;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(0,0,0,.22);
      color:var(--muted);
      font-weight:900;
    }
    .btn.primary{
      background:linear-gradient(135deg, rgba(255,211,106,.95), rgba(255,184,77,.80));
      color:#111;
      border:none;
    }
    .btn:disabled{
      opacity:.55;
      cursor:not-allowed;
      filter:saturate(.85);
    }

    /* ‚úÖ Modal */
    .modalMask{
      position:fixed; inset:0;
      background:rgba(0,0,0,.55);
      backdrop-filter:blur(10px);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:9999;
    }
    .modal{
      width:min(520px, 100%);
      border-radius:22px;
      background:var(--panel2);
      border:1px solid rgba(255,255,255,.12);
      box-shadow:0 20px 60px rgba(0,0,0,.55);
      overflow:hidden;
      position:relative;
      transform:translateY(10px) scale(.98);
      opacity:0;
      transition:.18s ease;
    }
    .modalMask.show{ display:flex; }
    .modalMask.show .modal{ transform:translateY(0) scale(1); opacity:1; }

    .modalTop{
      padding:14px 14px 10px;
      display:flex; align-items:center; justify-content:space-between;
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .modalTop strong{ font-size:14px; }
    .xbtn{
      width:34px;height:34px;border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.25);
      color:var(--text);
      cursor:pointer;
      font-weight:900;
    }
    .modalBody{ padding:16px 14px 16px; }
    .bigLine{ font-size:18px; font-weight:950; margin:0 0 6px; }
    .smallLine{ margin:0; color:var(--muted); font-size:14px; line-height:1.45; }

    .modalChest{
      margin:14px auto 6px;
      width:86px; height:86px;
      display:block;
      filter:drop-shadow(0 16px 24px rgba(0,0,0,.45));
      animation:pop .22s ease;
    }
    @keyframes pop{
      from{ transform:scale(.8) rotate(2deg); opacity:.2; }
      to{ transform:scale(1) rotate(0); opacity:1; }
    }

    .gyroHint{
      margin-top:10px;
      display:flex;
      gap:10px;
      align-items:center;
      padding:10px 12px;
      border-radius:16px;
      background:rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.10);
      color:var(--muted);
      font-size:13px;
    }
    .gyroBtn{
      margin-left:auto;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.20);
      color:var(--text);
      cursor:pointer;
      font-weight:900;
      font-size:13px;
    }

    footer{
      margin-top:auto;
      padding:12px 6px 0;
      color:rgba(238,246,255,.55);
      font-size:12px;
      text-align:center;
    }
  </style>
</head>

<body>
  <div class="bgWrap" aria-hidden="true">
    <div class="bg" id="bg"></div>
    <div class="shade"></div>
    <div class="vignette"></div>
  </div>

  <main class="wrap">
    <div class="topbar">
      <div class="brand"><div class="logo"></div><div>Mini Game</div></div>
      <div class="menu">Menu ‚ò∞</div>
    </div>

    <section class="card chat">
      <div class="bubble">Bossku‚Ä¶ jom try sikit. Santai je üòÑ</div>
      <div class="bubble me">Pilih satu chest dulu, lepas tu tekan <b>Pilih</b>.</div>

      <div class="gyroHint">
        <span>Tip: Kalau guna phone, boleh bagi page ni ‚Äúbergerak‚Äù sikit üëÄ</span>
        <button class="gyroBtn" id="gyroBtn">Aktifkan Gerakan</button>
      </div>
    </section>

    <section class="card">
      <div class="game">
        <div>
          <div class="headline">Pilih satu, cuba nasib</div>
          <div class="sub">Setiap chest hanya boleh pilih sekali. <b>Kali ke-3</b> baru terus pergi.</div>

          <div class="progress">
            <span id="stepText">Step 0/3</span>
            <div class="bar"><i id="barFill"></i></div>
          </div>
        </div>

        <div class="choices" id="choices">
          <div class="choice" data-chest="A">
            <img class="chest-icon" src="./image-box.png" alt="Chest A">
            <strong>Chest A</strong><span>Cuba sini</span>
          </div>
          <div class="choice" data-chest="B">
            <img class="chest-icon" src="./image-box.png" alt="Chest B">
            <strong>Chest B</strong><span>Cuba sini</span>
          </div>
          <div class="choice" data-chest="C">
            <img class="chest-icon" src="./image-box.png" alt="Chest C">
            <strong>Chest C</strong><span>Cuba sini</span>
          </div>
        </div>

        <div class="cta">
          <button class="btn" id="btnInfo">Tengok Lagi</button>
          <button class="btn primary" id="btnPick" disabled>Pilih</button>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="game">
        <div style="font-weight:950;margin-bottom:2px">Soalan biasa</div>
        <details style="margin-top:10px;border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.18);border-radius:14px;padding:10px 12px;">
          <summary style="cursor:pointer;font-weight:900;list-style:none;">Ini game apa sebenarnya?</summary>
          <p style="margin:8px 0 0;color:rgba(238,246,255,.72);font-size:13.5px;line-height:1.45;">
            Mini interaksi je untuk test flow. Santai, try dulu.
          </p>
        </details>
        <details style="margin-top:10px;border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.18);border-radius:14px;padding:10px 12px;">
          <summary style="cursor:pointer;font-weight:900;list-style:none;">Kenapa hanya 3 kali?</summary>
          <p style="margin:8px 0 0;color:rgba(238,246,255,.72);font-size:13.5px;line-height:1.45;">
            Supaya flow nampak ‚Äúreal‚Äù dan ada suspense sikit üòÑ
          </p>
        </details>
        <details style="margin-top:10px;border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.18);border-radius:14px;padding:10px 12px;">
          <summary style="cursor:pointer;font-weight:900;list-style:none;">Data aku selamat?</summary>
          <p style="margin:8px 0 0;color:rgba(238,246,255,.72);font-size:13.5px;line-height:1.45;">
            Kita track klik/step asas sahaja. Tak minta info peribadi dekat sini.
          </p>
        </details>
      </div>
    </section>

    <footer>Privacy ¬∑ Terms ¬∑ Contact</footer>
  </main>

  <!-- ‚úÖ Modal -->
  <div class="modalMask" id="modalMask" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <div class="modalTop">
        <strong id="modalTitle">Chest Dibuka</strong>
        <button class="xbtn" id="modalClose">‚úï</button>
      </div>
      <div class="modalBody">
        <img class="modalChest" src="./image-box.png" alt="Chest open" />
        <p class="bigLine" id="modalBig">Cuba Lagi üòâ</p>
        <p class="smallLine" id="modalSmall">Pilih chest lain ya‚Ä¶</p>
      </div>
    </div>
  </div>

  <script>
    // ====== SETTINGS ======
    const NEXT_URL = "https://abangcuci44.com/signup/?rf=017gz180"; // ‚úÖ Á¨¨3Ê¨°Ë∑≥ËøôÈáå
    const TOTAL_ROUNDS = 3;

    // ====== helpers ======
    function safeFbq(eventName, params){
      try{
        if(window.fbq){
          fbq('trackCustom', eventName, params || {});
        }
      }catch(e){}
    }

    // ====== UI refs ======
    const choicesEl = document.getElementById('choices');
    const btnPick   = document.getElementById('btnPick');
    const btnInfo   = document.getElementById('btnInfo');
    const stepText  = document.getElementById('stepText');
    const barFill   = document.getElementById('barFill');

    const modalMask = document.getElementById('modalMask');
    const modalClose= document.getElementById('modalClose');
    const modalTitle= document.getElementById('modalTitle');
    const modalBig  = document.getElementById('modalBig');
    const modalSmall= document.getElementById('modalSmall');

    const bg = document.getElementById('bg');
    const gyroBtn = document.getElementById('gyroBtn');

    let selectedEl = null;
    let round = 0;

    function setStep(n){
      stepText.textContent = `Step ${n}/${TOTAL_ROUNDS}`;
      barFill.style.width = (n / TOTAL_ROUNDS * 100) + '%';
    }
    setStep(0);

    function openModal(bigText, smallText){
      modalBig.textContent = bigText;
      modalSmall.textContent = smallText || "";
      modalMask.classList.add('show');
      modalMask.setAttribute('aria-hidden','false');
    }
    function closeModal(){
      modalMask.classList.remove('show');
      modalMask.setAttribute('aria-hidden','true');
    }
    modalClose.addEventListener('click', closeModal);
    modalMask.addEventListener('click', (e)=>{
      if(e.target === modalMask) closeModal();
    });

    // ====== select chest ======
    choicesEl.addEventListener('click', (e)=>{
      const box = e.target.closest('.choice');
      if(!box) return;
      if(box.classList.contains('used')) return;

      document.querySelectorAll('.choice').forEach(el=>el.classList.remove('selected'));
      box.classList.add('selected');
      selectedEl = box;

      btnPick.disabled = false;

      safeFbq('Chest_Select', { chest: box.dataset.chest, step: round+1 });
    });

    // ====== pick logic (3 rounds fixed) ======
    btnPick.addEventListener('click', ()=>{
      if(!selectedEl) return;

      // lock selected chest
      selectedEl.classList.add('used');
      selectedEl.classList.remove('selected');
      btnPick.disabled = true;

      round += 1;
      setStep(round);

      const chest = selectedEl.dataset.chest;

      // Clear selection (must choose next chest)
      selectedEl = null;

      // Track click
      safeFbq('Pick_Click', { round, chest });

      if(round === 1){
        openModal("Cuba Lagi üòâ", "Ok bossku, pilih chest lain pula ya.");
        safeFbq('Round1', { chest });
      }else if(round === 2){
        openModal("Free 3 üéÅ", "Nice. Last round lepas ni terus masuk.");
        safeFbq('Round2', { chest });
      }else if(round === 3){
        openModal("Welcome New Member 100% üéâ", "Kejap ya‚Ä¶ terus masuk sekarang.");
        safeFbq('Round3_Final', { chest });

        setTimeout(()=>{
          safeFbq('Redirect', { to: NEXT_URL });
          window.location.href = NEXT_URL;
        }, 1400);
      }
    });

    // ====== info button ======
    btnInfo.addEventListener('click', ()=>{
      safeFbq('Info_Click', { round: round });
      document.querySelector('details')?.scrollIntoView({behavior:'smooth', block:'center'});
    });

    // ====== Parallax (desktop mouse) ======
    let mx=0, my=0, tx=0, ty=0;
    window.addEventListener('mousemove', (e)=>{
      const w = window.innerWidth, h = window.innerHeight;
      mx = (e.clientX / w - 0.5);
      my = (e.clientY / h - 0.5);
    });

    // ====== Gyro (mobile) ======
    let gx=0, gy=0;
    let gyroEnabled = false;

    async function enableGyro(){
      try{
        // iOS needs permission
        if(typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function'){
          const res = await DeviceOrientationEvent.requestPermission();
          if(res !== 'granted'){
            openModal("Tak lepas izin üòÖ", "Kalau nak effect bergerak, tekan allow ya.");
            return;
          }
        }
        window.addEventListener('deviceorientation', (ev)=>{
          // gamma: left-right, beta: front-back
          const gamma = ev.gamma || 0; // -90..90
          const beta  = ev.beta  || 0; // -180..180
          gx = Math.max(-1, Math.min(1, gamma / 35));
          gy = Math.max(-1, Math.min(1, beta / 35));
        }, { passive:true });

        gyroEnabled = true;
        gyroBtn.textContent = "Gerakan ON ‚úÖ";
        safeFbq('Gyro_On', {});
      }catch(err){
        openModal("Device tak support üòÖ", "Takpe bossku, still boleh jalan normal.");
      }
    }
    gyroBtn.addEventListener('click', enableGyro);

    // ====== animation loop ======
    function loop(){
      // smooth toward target
      // mouse parallax
      const mouseX = mx * 22;
      const mouseY = my * 22;

      // gyro parallax
      const gyroX = gyroEnabled ? gx * 26 : 0;
      const gyroY = gyroEnabled ? gy * 26 : 0;

      // combine
      tx += ((mouseX + gyroX) - tx) * 0.08;
      ty += ((mouseY + gyroY) - ty) * 0.08;

      bg.style.transform = `translate3d(${tx}px, ${ty}px, 0) scale(1.06)`;

      requestAnimationFrame(loop);
    }
    loop();

    // ====== quick asset check (helps GitHub case issues) ======
    (function(){
      const test = new Image();
      test.onload = ()=> safeFbq('Bg_Load_OK', {});
      test.onerror= ()=> openModal("Background tak jumpa ‚ùå", "Pastikan nama fail tepat: abgc44.gif (huruf kecil semua).");
      test.src = "./abgc44.gif?ts=" + Date.now();
    })();
  </script>
</body>
</html>
